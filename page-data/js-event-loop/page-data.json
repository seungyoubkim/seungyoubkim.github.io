{"componentChunkName":"component---src-templates-blog-post-js","path":"/js-event-loop/","result":{"data":{"site":{"siteMetadata":{"title":"Seungyoub Kim Blog"}},"markdownRemark":{"id":"d7ff621c-b58a-50ce-84ea-aa70282d5ad8","excerpt":"…","html":"<blockquote>\n<p>⚠️ 해당 글의 내용과 예시 코드, 이미지는 모두 참고 자료에서 가져 와 정리 한 것입니다.</p>\n</blockquote>\n<p>자바스크립트는 싱글 스레드 기반의 프로그래밍 언어로 한번에 하나의 일만 처리 할 수 있습니다.</p>\n<p>이것은 <strong>콜 스택</strong>이 <strong>하나</strong>라는 뜻인데요.</p>\n<p><strong>콜 스택</strong>이 무엇인지 알아보기 위해 <strong>자바스크립트 구조</strong>에 대해 간단히 알아 볼 필요가 있습니다.</p>\n<h1>V8 엔진</h1>\n<hr>\n<p>자바스크립트로 구현 된 코드는 보통 <strong>자바스크립트 엔진</strong>을 이용해 실행하게 됩니다.</p>\n<p>자바스크립트 엔진은 여러가지가 있지만 그중 가장 유명한 것은 <strong>V8 엔진</strong> 이라고 할 수 있습니다.</p>\n<p><strong>V8 엔진</strong>은 구글에서 개발한 오픈 소스 프로젝트로 크롬, Node.js 등에서 사용됩니다.</p>\n<p><strong>V8 엔진</strong>은 간단히 표시하여 아래와 같은 모습으로 볼 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4064394f9b7f1fafb49a8ace19f23c42/5a190/1_X21ybPxqBtfRV5v9rD9J1A.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVQoz6XR3U7CMBgGYG6Im9CLI/HYE+9AT4yJZICyzWWRzZLgftiASMpQExlsbQdmrPtpDWA4MBmQ+KZHb/ukX9oKLw/brgOplChepPOcmjy3WRbuyxMwyzd4eTtQz5/vz9JI2JfHMdueS9H1zVX1slaNw7tNWWQnjl1wzukSIK8WfVzQVW9XMsaO4DRNk4RSStPs96qiKJIkWa/XRzBjTNM67QdBakutZvN7tVrHsSzLrVZLEARN0/I8L8URwW1J6U/TGfH7Q2s4GEIITdOM45hSKkkSQqgUE4JVTZ8vuRJIj2+NyWgCJxBCuNvVdR1jXIoxQsAw+ec717UZIW6/73meYRi+7wdBIIpiFEXlGGPQ7e7ebeb7ruN6nmea5mKxQAiJokgIKcUI4dceaCj8K+AYzZ0ttm07DENCiCzLhzAhRFGeZv4qDMloNHRddzqdqqo6Ho8hhPV6/dDYnHPHcQDQAHgBACRJkmUZAEDX9U6nY1nWn6+u8H/kB/6TUHO5WhYqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1 X21ybPxqBtfRV5v9rD9J1A\"\n        title=\"1 X21ybPxqBtfRV5v9rD9J1A\"\n        src=\"/static/4064394f9b7f1fafb49a8ace19f23c42/f058b/1_X21ybPxqBtfRV5v9rD9J1A.png\"\n        srcset=\"/static/4064394f9b7f1fafb49a8ace19f23c42/c26ae/1_X21ybPxqBtfRV5v9rD9J1A.png 158w,\n/static/4064394f9b7f1fafb49a8ace19f23c42/6bdcf/1_X21ybPxqBtfRV5v9rD9J1A.png 315w,\n/static/4064394f9b7f1fafb49a8ace19f23c42/f058b/1_X21ybPxqBtfRV5v9rD9J1A.png 630w,\n/static/4064394f9b7f1fafb49a8ace19f23c42/5a190/1_X21ybPxqBtfRV5v9rD9J1A.png 800w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>V8 엔진</strong>은 크게 <strong>메모리 힙</strong>, <strong>콜 스택</strong> 두 부분으로 나눌 수 있습니다.</p>\n<p><strong>메모리 힙</strong>은 프로그램에서 선언 한 변수, 함수 등의 메모리 할당이 이루어지는 곳입니다.</p>\n<p><strong>콜 스택</strong>은 코드가 실행 되면서 <strong>스택 프레임</strong>이 쌓이는 곳입니다.</p>\n<p><strong>메모리 힙</strong>은 대충 이해가 가지만 <strong>콜 스택</strong>은 쉽게 이해가 가지 않습니다.</p>\n<p><strong>콜 스택</strong>에 대해 좀 더 자세히 알아보도록 하겠습니다.</p>\n<h1>콜 스택</h1>\n<hr>\n<p><strong>콜 스택</strong>은 기본적으로 엔진이 현재 프로그램의 어디에 있는지를 기록하는 자료구조입니다.</p>\n<p>엔진이 어떠한 함수를 실행하는 순간 <strong>해당 함수</strong>를 <strong>콜 스택</strong>에 <strong>push</strong> 를 하게 됩니다.</p>\n<p>그리고 어떠한 함수가 종료되는 순간 <strong>콜 스택</strong>에서 <strong>pop</strong> 을 하게 됩니다.</p>\n<p><strong>콜 스택</strong>이 할 수 있는 일은 오로지 이것 뿐입니다.</p>\n<p>아래 예시 코드를 통해 더 자세히 알아보도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> x <span class=\"token operator\">*</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">printSquare</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> s <span class=\"token operator\">=</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">printSquare</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>엔진이 위 코드를 실행하기 전에는 <strong>콜 스택</strong>이 비어있는 상태입니다. 이후의 단계는 아래 이미지와 같습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/add7f4161b8bfa2326ff8860df3aeabe/5a190/1_1FL2WcODqRrK40rrzA5QQA.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQoz6WT3YrCMBBG+/5vIuIPqxf6GiL2ThCljdAmmUxinLROFjrg9sJdWfyuThoO8yUlRf4gxW8bzNw0jVKq7/t/yznnvu+7rmPmv+SUEhHJeszdEGEiGrPUKbquu16vl8vldrullJRS5/NZuK5r+R5jrKqqruvbkNPppJQiogIA7vd7ztk5p7WWscIpJWa21mqt+yHGGGstMxMRABSIKH1CCMYY6TNmRBQh5wwAzjm5DkR8LzvnnrK1FgBeyN77pmlEGDMAtG0rVyW1X8tyZmZGROHH42GtNca8ru2GxBhlwmazmc1mh8NBa71arebzeVmWiOi9DyForRHxRzbGbLfbxWKx3+8BYL1eTyaT3W7Xtu1yuZxOp2VZVlX1NeR4PCJiSkmGFSklP0T+rXCMkYjGHELw3hNRjPHJxacPg4c838NbfsrfXZhfJsQtrXoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1 1FL2WcODqRrK40rrzA5QQA\"\n        title=\"1 1FL2WcODqRrK40rrzA5QQA\"\n        src=\"/static/add7f4161b8bfa2326ff8860df3aeabe/f058b/1_1FL2WcODqRrK40rrzA5QQA.png\"\n        srcset=\"/static/add7f4161b8bfa2326ff8860df3aeabe/c26ae/1_1FL2WcODqRrK40rrzA5QQA.png 158w,\n/static/add7f4161b8bfa2326ff8860df3aeabe/6bdcf/1_1FL2WcODqRrK40rrzA5QQA.png 315w,\n/static/add7f4161b8bfa2326ff8860df3aeabe/f058b/1_1FL2WcODqRrK40rrzA5QQA.png 630w,\n/static/add7f4161b8bfa2326ff8860df3aeabe/5a190/1_1FL2WcODqRrK40rrzA5QQA.png 800w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n콜 스택의 각각의 요소는 <strong>스택 프레임</strong> 이라고 부릅니다.</p>\n<p>또한 프로그램에서 예외가 발생하였을 때 생성되는 <strong>스택 트레이스</strong>는 기본적으로 예외가 발생하였을 때의 <strong>콜 스택의 상태</strong>입니다.</p>\n<p>아래 예시 코드를 살펴보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">//foo.js</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SessionStack will help you resolve crashes :)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>만일 위 코드를 크롬에서 실행 시킨다면 아래와 같은 <strong>스택 트레이스</strong>를 볼 수 있을 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 507px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e7a68aaf1421826ee126d530fc49956c/3ebb1/Untitled3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.556962025316455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhElEQVQI143JywqEIACF4d7/2SKIhMq0pCBCUFsNE6X/UMPcdrP44FyyQ0piXXO0LZvWbH3P3jQkrYknY4jD8MzTRFTqsynFviy4YcAbw91aMrwnSQlVRahrZFEwlyXJWs7vzbnf/tpC4HDukkIgY11JXYfLc6wQGCHw48htnrm+P/DlAVVu4bcfKfMxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled3\"\n        title=\"Untitled3\"\n        src=\"/static/e7a68aaf1421826ee126d530fc49956c/3ebb1/Untitled3.png\"\n        srcset=\"/static/e7a68aaf1421826ee126d530fc49956c/c26ae/Untitled3.png 158w,\n/static/e7a68aaf1421826ee126d530fc49956c/6bdcf/Untitled3.png 315w,\n/static/e7a68aaf1421826ee126d530fc49956c/3ebb1/Untitled3.png 507w\"\n        sizes=\"(max-width: 507px) 100vw, 507px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>또한 코딩을 하다 종종 만나 볼 수 있는 <strong>Maximum call stack size exceeded</strong> 에러 또한 아래 이미지와 같이 <strong>콜 스택</strong>에 쌓인 <strong>스택 프레임</strong>들이 제거되지 못하고 계속하여 쌓이기만 하여 <strong>콜 스택</strong>의 <strong>최대 크기</strong>에 도달 했을 때 브라우저가 던지는 <strong>에러</strong>입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4df869c2f6ee2804931cc9f6244c2387/2bef9/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABg0lEQVQ4y5WUyQ6CQAyGff/XMMFEiBgFEk+8hhfc2Nxw3xVr/iYdBx0PNmmgM9OvG0ONfsjz+aw8Teu6ylpN39SdxH48HjSfz2k2m9H9fjcG0ddqv0CfWZRlWdm/3W602WxY9UCc4fV6pdPppEDn8/nLxhk9E9hxHNN4PKbL5fIGYgPlZFlGh8OBnfM8Z/t4PLKdpimvIYgAYVuWRfV6ncEKuN1uVXSkv1qtuG+Q9XrNNsqFwhaZTCbkui7Ztk2DweAN3O12qgf7/Z6d4AzBHoJI7xBcMtSBo9HIDMS7DgQAQDmsA5MkoW63S61W6xuIiQlguVyqsgArikJNGeUjOGwMo91uk+M4NBwOq0CJiqHACVNDX7GHhvd6PVZkpffQCERWgMhAptMpl9JsNimKIp5wo9HgiUppAkS5OFcBAhKGIXmeR/1+nxaLBWfT6XR4evh8giAg3/cZIiKZYw/lKyB6gvLQRzxhQ/HpYO1TReS8+FZuyj/yeT2Nd/kfNd1z/W/zApQJe6Ity+WuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/4df869c2f6ee2804931cc9f6244c2387/f058b/1.png\"\n        srcset=\"/static/4df869c2f6ee2804931cc9f6244c2387/c26ae/1.png 158w,\n/static/4df869c2f6ee2804931cc9f6244c2387/6bdcf/1.png 315w,\n/static/4df869c2f6ee2804931cc9f6244c2387/f058b/1.png 630w,\n/static/4df869c2f6ee2804931cc9f6244c2387/40601/1.png 945w,\n/static/4df869c2f6ee2804931cc9f6244c2387/2bef9/1.png 1024w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 386px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/88d01c97077754b5b0bd09b1a1847b42/7bc0b/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 5.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQ0lEQVQI1yWLQQrAIBAD+/+nteBBEXVFP1GPoVOWPQQyQ3K998Mx4ysF5YzMUErIee+I+1rRGGhO1Ht03zq3Fp+1+AGHR0kVCE5ZqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/88d01c97077754b5b0bd09b1a1847b42/7bc0b/2.png\"\n        srcset=\"/static/88d01c97077754b5b0bd09b1a1847b42/c26ae/2.png 158w,\n/static/88d01c97077754b5b0bd09b1a1847b42/6bdcf/2.png 315w,\n/static/88d01c97077754b5b0bd09b1a1847b42/7bc0b/2.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>싱글 스레드</h1>\n<hr>\n<p>위에서 <strong>자바스크립트</strong>는 <strong>싱글 스레드 기반의 프로그래밍 언어</strong>이고 <strong>콜 스택이 하나</strong>라고 이야기 했습니다.</p>\n<p>이 말은 <strong>콜 스택</strong>에 <strong>수행 할 함수가 존재</strong>한다면 브라우저는 <strong>콜 스택이 비워 질 때까지 다른 일을 할 수 없음</strong> 을 의미합니다.</p>\n<p>브라우저가 응답 없음 상태로 <strong>멈추게 된다</strong>는 뜻입니다.</p>\n<p>이것을 <strong>블록킹 되었다</strong>(blocked) 라고 합니다.</p>\n<p>그렇게 콜 스택 내의 함수들이 많은 시간을 소요하여 브라우저가 <strong>일정 시간 이상 응답이 없을 경우</strong> 대부분의 브라우저는 아래와 같은 에러를 일으키게 됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 462px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/996945bcf739336d24ee06838b5fc396/e389b/10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9ElEQVQoz4WRS0/bQBDH830LvfQjlPbcqkWquMMnyAWpEicuoa+DSdI48YsY8sDxe23v2v5V6xCRVkBH+mlnZmf+O6PtvTs1ODq95u2Zyfuza45ODXTuzZcRB59HvD4ecXg85vBY+9vzkTEHnwwOP37vePXhG737MCdKC4zRlCDKidOSTZzj+ks8f43rL3Dniy525gtublfbu/kKz1+xChLCpGATC25XEb2yKvn18wdXVwM8z6UQOW1bM/ccZuYE25pgWRNsx8LUsTNlZk1xnRmmOcb3fWRVAQ25EPQqqQiCDcPhkMFgwHj8m7qucSyLyWSC49jYtoVlWTiOi2WbTG2zi++DgCiOEaJAKUWc5vSkqsmyjH6/z8nJCRcXF5RlSRiGRHHE3eKOuX/DZrMhTVOyLCXLU+I4QSpF0zRIKR8EMy2oukLTNDEMg8vLS4QQVFVFXStW90sWyzsqKdHWti1t27mdmN5Gn23bbAXLSnbJfdMv7gp3tmt+Dn3fCeqXlZTdRPuoh3X2G56i7mqafwSV+gs9oXwi/xJNXZPsVtYT7UT2/f+ha0VZUVSSoqoef3nuu0ztMdfDIev1uvuMWj2PnkjXlFIxczzOz7/i+UuSXNBL84Iky4jTlChJSLOcvCjIi/JFRFGSiYIwyQkT3S8IooQ/1oODP+pRW0MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"10\"\n        title=\"10\"\n        src=\"/static/996945bcf739336d24ee06838b5fc396/e389b/10.png\"\n        srcset=\"/static/996945bcf739336d24ee06838b5fc396/c26ae/10.png 158w,\n/static/996945bcf739336d24ee06838b5fc396/6bdcf/10.png 315w,\n/static/996945bcf739336d24ee06838b5fc396/e389b/10.png 462w\"\n        sizes=\"(max-width: 462px) 100vw, 462px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>물론 에러가 발생하지 않는다고 하여도 <strong>장시간 동안 응답하지 않는 웹 서비스</strong>가 사용자에게 좋은 사용자 경험을 준다고 이야기 할 수는 <strong>없겠습니다</strong>.</p>\n<p>그렇다면 위 싱글 스레드의 문제점을 해결하려면 어떻게 해야 할까요?</p>\n<h1>비동기 처리</h1>\n<hr>\n<p><strong>지금</strong> 실행 할 수 없는 작업은 <strong>나중에</strong> 실행하면 됩니다.</p>\n<p>이 말은 <strong>지금 완료 할 수 없는 작업</strong>을 <strong>비동기 적</strong>으로 수행한다는 이야기입니다.</p>\n<p>아래 예시 코드를 보도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// ajax(..) is some arbitrary Ajax function given by a library</span>\n<span class=\"token keyword\">var</span> response <span class=\"token operator\">=</span> <span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;https://example.com/api>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// `response` won't have the response</span></code></pre></div>\n<p>우리는 response 변수의 출력을 원하는 시점에 원하는 값이 아직 할당 되지 않았음을 알고 있습니다.</p>\n<p>이 말은 <strong>Ajax 함수가 실행된 시점</strong>에는 아직 response 에 할당 할 <strong>반환 값이 없다</strong>는 이야기입니다.</p>\n<p>이 말은 Ajax 함수가 <strong>비동기 적</strong>으로 수행된다는 이야기 입니다.</p>\n<p>아래 코드와 같이 Ajax 함수를 <strong>동기 적</strong>으로 수행 할 수 있는 방법도 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// This is assuming that you're using jQuery</span>\njQuery<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'&lt;https://api.example.com/endpoint>'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// This is your callback.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">async</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token comment\">// And this is a terrible idea</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>하지만 이 방법을 사용 할 시 Ajax 요청에 응답이 올 때 까지 브라우저는 <strong>동작을 멈춰 버릴 것</strong>입니다.</p>\n<p>이는 사용자 경험을 최악으로 떨어뜨리는 <strong>매우 안좋은 방법</strong>입니다.</p>\n<p>그렇다면 비동기 함수가 결과를 반환 하기를 <strong>기다릴 수 있는 방법</strong>은 무엇이 있을까요?</p>\n<p>우선 가장 간단한 방법은 아래 코드와 같이 <strong>콜백 함수</strong>를 이용하는 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;https://example.com/api>'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// `response` is now available</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Ajax 함수는 요청에 <strong>응답이 오면</strong> 두번째 인자로 넘겨진 <strong>콜백 함수</strong>를 <strong>호출</strong> 할 것입니다.</p>\n<p>위 같은 방법을 <strong>콜백 함수를 이용한 비동기 처리</strong> 이라고 합니다.</p>\n<p>위처럼 비동기 적인 수행을 하는 방법을 <strong>비동기 처리</strong> 이라고 합니다.</p>\n<p><strong>비동기 처리</strong> 대해서는 <a href=\"/js-async\">다음 글</a>에서 좀 더 자세히 알아보도록 하겠습니다.</p>\n<p>다시 이어서 <strong>자바스크립트 구조</strong>에 대해서 이야기를 해보도록 하겠습니다.</p>\n<h1>호스팅 환경</h1>\n<hr>\n<p>위에서 살펴 보았듯이 <strong>자바스크립트 엔진</strong>은 <strong>콜 스택에 쌓인 함수를 실행하는 것</strong> 외에는 특별한 일을 하는 것은 <strong>없습니다</strong>.</p>\n<p>그렇다면 <strong>비동기 콜백 함수</strong>는 어떻게 동작하는 것 일까요?</p>\n<p>자바스크립트 엔진에게 어떠한 프로그램의 코드를 실행 하라고 <strong>명령</strong>하는 것은 <strong>무엇</strong> 일까요?</p>\n<p>사실 자바스크립트 엔진은 <strong>혼자서 동작하는 것이 아니라</strong> 자바스크립트 엔진이 수행 될 <strong>호스팅 환경</strong> 내에서 수행됩니다.</p>\n<p>아마 대부분의 경우에 이것은 <strong>브라우저</strong> 혹은 <strong>Node.js</strong> 일 것입니다.</p>\n<p>(요즘에는 자바스크립트가 로봇에서 부터 스마트 전구까지 각종 장치에도 내장되고 있습니다.)</p>\n<p>이러한 대부분의 호스팅 환경에 적용되어 있는 메커니즘이 바로 <strong>이벤트 루프</strong> 라는 것입니다.</p>\n<p>이것은 시간의 흐름에 따라 코드의 수행을 처리하며 그 때마다 자바스크립트 엔진을 작동 시킵니다.</p>\n<p>사실 <strong>자바스크립트</strong>가 <strong>싱글 스레드 기반의 프로그래밍 언어</strong>라는 말은 <strong>자바스크립트 엔진</strong>이 <strong>하나의 콜 스택 만을 사용한다</strong>는 이야기 이지 자바스크립트 엔진이 수행되는 <strong>호스팅 환경</strong>에선 주로 <strong>여러 개의 스레드</strong>가 사용됩니다.</p>\n<p>이러한 구동 환경을 <strong>단일 콜 스택</strong> 만을 사용하는 <strong>자바스크립트 엔진</strong>과 <strong>상호 연동</strong> 하기 위해 사용하는 장치가 바로 <strong>이벤트 루프</strong> 라고 할 수 있습니다.</p>\n<p><strong>이벤트 루프</strong>에 대해 좀 더 자세히 알아보도록 하겠습니다.</p>\n<h1>이벤트 루프</h1>\n<hr>\n<p>위에서 이야기 하였듯이 <strong>자바스크립트 프로그램</strong>은 <strong>자바스크립트 엔진</strong> 만으로 동작하는 것이 <strong>아닙니다</strong>.</p>\n<p>많은 자바스크립트 개발자들이 사용하는 <strong>DOM</strong>, <strong>AJAX</strong>, <strong>setTimeout</strong> 등의 함수들은 <strong>Web API</strong> 라는 것인데 이 Web API 는 <strong>브라우저</strong>에서 제공을 하고 있습니다.</p>\n<p>아래 이미지와 같이 Web API 외에도 <strong>이벤트 루프</strong>와 <strong>콜백 큐</strong>도 브라우저에 구현이 되어 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7299ec41566ffd25e8fd9772f74c714d/5a190/11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoklEQVQ4y5VT2W7TQBT1T/BlvPABIJB46UMFYhNiUYWERHniGSREAQnoB6TN4iRO7CS1idzGJErbNK6yekkcO4s9B90JcdqqL4x0NTP3js49Z+aMgP8YjLFL69WW5ihiPCfM53PYtn0hHFi2w+eLeTq3BloBh2AR5aO4kVAsFpHJZHBwcIBSqYRSSYGqKiiXFb6nPNUVRVlChCHBwnEZ6k0HWrWN49MROr0IEz+CQAdns9la1/gLzn7fx9z+GaeoXi6XL8l/+8HBrXt93H0wxJ3NAW7e7iKVD5aAjuPEd9KqbmD7+Q3UlCf/JEZccqVSgeuOoOuHODfPsLM7xcazAR5vWXj6xsLmiyFK2hSCLMuYTCZx56mTgN16j6mbWZMejzlDakjrKJzj8w8PD19bePnOxqttG4+2LJQJkDqb7TZOjpuo1+sYWmMO4gch3zebTQwGA36XF0cyF+DjtzG+7nrY+eXh0/cxGifzpeRUKoWcJEOraChIeYxGDgoFibOiSCaTICU0oii6ZJ+rQxDFDFKZLFouUJmpkLQs2i0Tuq7Hh7LZLNLpdAxI2sOIYbFgWITrIC8KWVFEjrqbJiZGBapxiPO2yZmR1OFwiP39fUagSxsu6bFraHJjE2BeyiNwfSAIcXh0BNM0uQe73S56vR4BkhfZykJhGMbr6XTKY+lPQEhnRMjFHIoa4M+BP4aOk9NTznA0GvFXJYZ7e3twXZd1Oh22WCw4IVKwahoEwfqn5HI56PoRjJrBgahjoVAA1WRZZolEgtErE1i1WmVkM8MwyAWsVquh0WhA0zT0+30IJI0k0aXTnM/nuUUkSeI5URQZMVRVlfxKrDhDy7LofjlLWhNL3/chUJGked6EG5wk0s+h2fM8HlRf0JNeeYPrbPMXzHJMZpK4HrUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"11\"\n        title=\"11\"\n        src=\"/static/7299ec41566ffd25e8fd9772f74c714d/f058b/11.png\"\n        srcset=\"/static/7299ec41566ffd25e8fd9772f74c714d/c26ae/11.png 158w,\n/static/7299ec41566ffd25e8fd9772f74c714d/6bdcf/11.png 315w,\n/static/7299ec41566ffd25e8fd9772f74c714d/f058b/11.png 630w,\n/static/7299ec41566ffd25e8fd9772f74c714d/5a190/11.png 800w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>콜백 큐</strong>란 비동기 적으로 실행 된 함수의 <strong>콜백 함수</strong>가 <strong>저장되는 곳</strong>입니다.</p>\n<p><strong>이벤트 루프</strong>란 <strong>콜백 큐</strong>와 <strong>콜 스택</strong>을 <strong>감시</strong>하여 <strong>콜 스택이 비어있는 경우 콜백 큐의 첫번째 요소를 콜 스택에 삽입</strong>하여 해당 함수가 자바스크립트 엔진에서 실행 될 수 있도록 합니다.</p>\n<p>콜백 큐와 콜 스택의 이름이 비슷하다고 헷갈리시면 안됩니다.</p>\n<p>콜백 큐는 <strong>브라우저</strong>에 존재하고 콜 스택은 <strong>자바스크립트 엔진</strong>에 존재하는 것입니다.</p>\n<p>예를 들어 보겠습니다.</p>\n<p>만약 서버에서 데이터를 가져오기 위해 <strong>Ajax 요청</strong>을 하는 자바스크립트 프로그램이 있다고 생각 해보겠습니다.</p>\n<p><strong>자바스크립트 엔진</strong>은 <strong>Web API</strong> 를 이용해 Ajax 요청을 하는 함수에서 <strong>호스팅 환경</strong>(브라우저)에게 아래와 같이 이야기를 할 것입니다.</p>\n<blockquote>\n<p>🗣 “나는 이제 <strong>이 함수</strong>를 <strong>종료</strong>시킬 거야. 하지만 너는 <strong>네트워크 요청에 응답이 오면</strong> 해당 응답을 이용해서 이 <strong>콜백 함수</strong>를 <strong>호출</strong>해줘.”</p>\n</blockquote>\n<p>그러면 <strong>브라우저</strong>는 <strong>네트워크 응답</strong>에 <strong>대기</strong>하고 있다가 <strong>응답이 오면</strong> 해당 응답과 함께 아까 받은 <strong>콜백 함수</strong>를 <strong>콜백 큐</strong>에 <strong>삽입</strong> 할 것입니다.</p>\n<p>그러면 <strong>이벤트 루프</strong>는 <strong>콜 스택</strong>을 <strong>감시</strong>하다가 <strong>콜 스택이 비었을 때</strong> <strong>콜백 큐</strong>에서 <strong>해당 함수</strong>를 <strong>콜 스택</strong>으로 넘겨 자바스크립트 엔진이 해당 함수를 실행 시킬 수 있도록 할 것입니다.</p>\n<p>아래 예시 코드를 통해 다시 한번 어떤 일이 벌어지는지 보도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">cb1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cb1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bye'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>해당 코드는 아래 이미지와 같은 과정을 거치게 됩니다.</p>\n<p><img src=\"/fffc0f806068767722e4d59c69afc0ab/12.gif\" alt=\"\"></p>\n<p>각 과정에 대한 자세한 설명은 <a href=\"https://engineering.huiseoul.com/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EA%B0%80-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%EC%9D%98-%EB%B6%80%EC%83%81-async-await%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%BD%94%EB%94%A9-%ED%8C%81-%EB%8B%A4%EC%84%AF-%EA%B0%80%EC%A7%80-df65ffb4e7e\">참고 링크</a>에서 확인 바랍니다.</p>\n<p>이렇게 <strong>이벤트 루프</strong>의 동작 과정에 대해 간단 하게는 이해를 하셨을 거라 생각합니다.</p>\n<h1>setTimeout</h1>\n<hr>\n<p>위 예시 코드에 나온 <strong>setTimeout</strong> 함수에 대해 조금 더 이야기를 해보도록 하겠습니다.</p>\n<p>우리는 <strong>setTimeout</strong> 함수가 <strong>일정 시간이 지난 후 콜백 함수를 실행</strong> 할 수 있도록 하는 함수라는 것을 모두 알고 있습니다.</p>\n<p>아래 예시 코드를 보도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>myCallback<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>우리는 이 코드가 <strong>1000ms 이후 myCallback 함수를 실행</strong>시켜 준다는 것을 알고 있습니다.</p>\n<p>하지만 위에서 배운 <strong>이벤트 루프</strong> 내용을 통해 myCallback 함수가 <strong>정확히 1000ms 이후</strong> 실행되는 것이 <strong>아니라</strong> <strong>1000ms 이후 콜백 큐에 myCallback 함수가 삽입되는 것</strong>이라는 것을 알게 되었습니다.</p>\n<p>이것이 setTimeout 함수가 콜백 함수의 <strong>정확한 실행 시간을 보장 할 수 없다</strong>고 이야기 하는 <strong>이유</strong>입니다.</p>\n<p>우리는 myCallback 함수가 setTimeout 함수가 실행 된지 <strong>1000ms 이후에 콜백 큐에 삽입</strong> 될 것이고 그 이후 <strong>콜 스택이 비워 지면</strong> myCallback 함수가 <strong>콜백 큐의 첫번째 요소 일 경우</strong> 콜 스택으로 옮겨져 실행 될 것이라는 것을 알 수 있습니다.</p>\n<p>또한 이제 아래 예시 코드의 실행 결과에 대해서도 이해를 할 수 있게 되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'callback'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bye'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>비록 setTimeout 의 <strong>대기 시간</strong>을 <strong>0</strong>으로 설정 하였지만 브라우저 콘솔의 <strong>출력 결과</strong>는 아래와 같음 을 알 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">Hi\nBye\ncallback</code></pre></div>\n<p>사실 브라우저들은 <strong>이벤트 루프가 동작하는 최소 시간 단위</strong>인 <strong>틱</strong>(tick)을 정해놓고 관리하기 때문에 setTimeout 의 대기 시간을 <strong>0</strong>으로 설정한다고 하여도 <strong>즉시 실행</strong>된다고 볼 수는 <strong>없습니다</strong>.</p>\n<p>(<strong>크롬</strong>의 경우 틱 기준이 <strong>4ms</strong> 이기 때문에 <code class=\"language-text\">setTimeout(fn, 0)</code> 이나 <code class=\"language-text\">setTimeout(fn, 4)</code> 이나 동일하게 작동 할 것입니다.)</p>\n<h1>마이크로 태스크 큐</h1>\n<hr>\n<p>아래 예시 코드를 보도록 하겠습니다.</p>\n<p>(<strong>Promise</strong> 코드에 대한 자세한 설명은 <strong>다음 글</strong>에서 좀 더 자세히 알아보도록 하겠습니다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// (A)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// (B)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'B'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// (C)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'C'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위 예시 코드의 출력 결과는 어떻게 될까요?</p>\n<p>위에서 배운 대로 생각해 본다면 <strong>setTimeout</strong> 과 <strong>Promise</strong> 모두 <strong>비동기 함수</strong> 이므로 <strong>A → B → C</strong> 순서대로 출력 될 것이라 예상 할 수 있습니다.</p>\n<p>하지만 출력 결과는 아래와 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token constant\">B</span>\n<span class=\"token constant\">C</span>\n<span class=\"token constant\">A</span></code></pre></div>\n<p>이 이유는 <strong>Promise</strong> 는 <strong>마이크로 태스크 큐</strong>를 사용하고 <strong>setTimeout</strong> 은 <strong>일반 태스크 큐</strong>를 사용하기 때문입니다.</p>\n<p>갑자기 이게 무슨 말이냐 하면 사실 <strong>콜백 큐</strong>는 <strong>하나의 큐</strong>가 <strong>아니었던 것</strong>입니다.</p>\n<p>당황 스럽지만 쉽게 이해를 해보도록 하겠습니다.</p>\n<p>사실 <strong>이벤트 루프</strong>는 콜 스택이 비면 <strong>여러 개의 콜백 큐</strong> 중 <strong>우선순위</strong>를 매겨 순서대로 확인하여 <strong>비어 있지 않는 큐</strong>를 찾아 첫번째 요소를 콜 스택으로 옮기는 것이었습니다.</p>\n<p>쉽게 말해 <strong>마이크로 태스크 큐</strong>는 <strong>일반 태스크 큐</strong>보다 <strong>우선순위가 높아</strong> 마이크로 태스크 큐에 들어있는 요소부터 콜 스택으로 옮겨지는 것입니다.</p>\n<p>(그 외에도 여러 콜백 큐들이 존재하지만 이번 글에선 생략합니다.)</p>\n<p>위 코드에 대해서 좀 더 살펴보자면 아래와 같은 순서로 동작 할 것입니다.</p>\n<ol>\n<li>우선 <strong>setTimeout</strong> 의 <strong>콜백 함수</strong>(A 함수)가 바로 <strong>다음 tick</strong> 에 <strong>일반 태스크 큐</strong>로 옮겨 집니다.</li>\n<li>그 다음 <strong>첫번째 Promise</strong> 가 바로 <strong>resolve</strong> 되었기 때문에 <strong>첫번째 then</strong> 함수의 <strong>콜백 함수</strong>(B 함수)가 <strong>마이크로 태스크 큐</strong>로 옮겨 집니다.</li>\n<li>그 다음 <strong>이벤트 루프</strong>는 <strong>마이크로 태스크 큐</strong>에서 <strong>B 함수</strong>를 <strong>콜 스택</strong>으로 옮깁니다.</li>\n<li><strong>B 함수</strong>가 실행되고 나면 <strong>두번째 then</strong> 함수의 <strong>콜백 함수</strong>(C 함수)가 <strong>마이크로 태스크 큐</strong>로 옮겨집니다.</li>\n<li><strong>이벤트 루프</strong>는 이번에도 <strong>마이크로 태스크 큐</strong>에서 <strong>C 함수</strong>를 <strong>콜 스택</strong>으로 옮깁니다.</li>\n<li><strong>C 함수</strong>가 실행되고 나면 <strong>이벤트 루프</strong>가 <strong>마이크로 태스크 큐</strong>를 확인하지만 <strong>비어 있기 때문</strong>에 <strong>일반 태스크 큐</strong>에서 <strong>A 함수</strong>를 <strong>콜 스택</strong>으로 옮깁니다.</li>\n<li><strong>A 함수</strong>가 실행됩니다.</li>\n</ol>\n<p>위처럼 <strong>콜백 큐</strong>는 하나의 큐가 아니라 <strong>여러 개의 큐</strong>이고 <strong>이벤트 루프</strong>는 여러 개의 큐중 <strong>우선순위</strong>를 매겨 <strong>순서대로 큐를 확인</strong>하여 <strong>요소가 있다면</strong> 첫번째 요소를 <strong>콜 스택</strong>으로 옮긴다는 것을 알 수 있습니다.</p>\n<h1>잡 큐</h1>\n<hr>\n<p><strong>잡 큐</strong>(Job Queue)는 <strong>ES6</strong>에서 <strong>Promise</strong>를 위해 새로 도입 된 개념이라고 합니다.</p>\n<p><strong>잡 큐</strong>는 쉽게 말해 <strong>이벤트 루프</strong>의 <strong>모든 틱의 끝에 부착 된 큐</strong>로 <strong>이벤트 루프 내의 비동기 처리</strong>에 사용된다고 합니다.</p>\n<p>이는 <strong>나중에 실행 될 수 있는 또 다른 요소</strong>를 추가 시킬 수 있으며 이것이 <strong>다른 어떤 요소보다도 우선적으로 실행</strong> 될 것이라는 것을 알 수 있다고 합니다.</p>\n<p>하지만 다른 내용들과 달리 무슨 말인지 쉽게 와닿지가 않습니다.</p>\n<p>잡 큐에 대해서는 다음 기회에 좀 더 자세히 알아보도록 하겠습니다.</p>\n<h2>참고 자료</h2>\n<hr>\n<ul>\n<li><a href=\"https://engineering.huiseoul.com/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EA%B0%80-%EC%97%94%EC%A7%84-%EB%9F%B0%ED%83%80%EC%9E%84-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EA%B0%9C%EA%B4%80-ea47917c8442\">자바스크립트는 어떻게 작동하는가: 엔진, 런타임, 콜스택 개관</a></li>\n<li><a href=\"https://engineering.huiseoul.com/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EA%B0%80-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%EC%9D%98-%EB%B6%80%EC%83%81-async-await%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%BD%94%EB%94%A9-%ED%8C%81-%EB%8B%A4%EC%84%AF-%EA%B0%80%EC%A7%80-df65ffb4e7e\">자바스크립트는 어떻게 작동하는가: 이벤트 루프와 비동기 프로그래밍의 부상, async/await을 이용한 코딩 팁 다섯 가지</a></li>\n<li><a href=\"https://meetup.toast.com/posts/89\">자바스크립트와 이벤트 루프</a></li>\n</ul>","frontmatter":{"title":"자바스크립트 콜 스택과 이벤트 루프","date":"August 04, 2020","description":"자바스크립트의 콜 스택과 이벤트 루프에 대해 알아봅니다."}},"previous":null,"next":{"fields":{"slug":"/js-async/"},"frontmatter":{"title":"자바스크립트 비동기 처리"}}},"pageContext":{"id":"d7ff621c-b58a-50ce-84ea-aa70282d5ad8","previousPostId":null,"nextPostId":"336aa070-94ab-5acc-a5a8-aaf81ac75c75"}},"staticQueryHashes":["2841359383","3257411868"]}